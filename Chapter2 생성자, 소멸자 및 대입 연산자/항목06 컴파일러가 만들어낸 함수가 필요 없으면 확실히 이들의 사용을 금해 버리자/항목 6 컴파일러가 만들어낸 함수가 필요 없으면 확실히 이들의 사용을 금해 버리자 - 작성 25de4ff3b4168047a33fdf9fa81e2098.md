# 항목 6: 컴파일러가 만들어낸 함수가 필요 없으면 확실히 이들의 사용을
금해 버리자 - 작성자: 권우현

<aside>

# 💡이것만은 잊지말자!

- 컴파일러에서 가동으로 제공호는 기능을 허용치 않으려면, 대응되는 멤버 함수를
private로 선언한 후에 구현은 하지 않은 채로 두십시오 Uncopyable과 비슷한 기본
클래스를 쓰는 것도 한 방법입니다
</aside>

---

## 1. 문제 상황: 복사하면 안 되는 객체

예시: 부동산 매물 클래스

```cpp
class HomeForSale { ... };

```

- **조건:** 현실 세계에서 집은 유일함 → 복사하면 안 됨
- 따라서 아래 코드는 허용되지 않아야 함

```cpp
HomeForSale h1;
HomeForSale h2;
HomeForSale h3(h1);  // 복사 생성자
h1 = h2;              // 복사 대입 연산자

```

- 그런데 C++에서는 **복사 생성자와 복사 대입 연산자가 자동으로 생성**될 수 있음
- 따라서 단순히 “선언하지 않는다”만으로는 충분하지 않음

---

## 2. 해결 방법 1: private 선언

C++에서 컴파일러가 자동 생성하는 함수는 **public** 멤버로 만들어짐

→ 외부에서 자유롭게 호출 가능

**복사 방지 전략:**

```cpp
class HomeForSale {
public:
    HomeForSale() {}
private:
    HomeForSale(const HomeForSale&);       // 복사 생성자
    HomeForSale& operator=(const HomeForSale&); // 복사 대입 연산자
};

```

- 선언만 있고 **정의는 없음**
- 효과:
    1. 컴파일러는 자동 복사 생성자/대입 연산자를 만들 수 없음
    2. 외부에서 호출하면 접근 제한(private) 때문에 컴파일 오류 발생
    3. 정의가 없으므로 혹시 내부에서 호출하려 해도 링크 시점에 에러 발생

---

## 3. 해결 방법 2: Uncopyable 기본 클래스 상속

여러 클래스에서 복사 방지를 일관되게 적용하려면, **기본 클래스**를 만들어 상속하는 방법이 좋음:

```cpp
class Uncopyable {
protected:
    Uncopyable() {}           // 생성자 허용
    ~Uncopyable() {}          // 소멸자 허용
private:
    Uncopyable(const Uncopyable&);        // 복사 방지
    Uncopyable& operator=(const Uncopyable&); // 복사 방지
};

```

- 특징:
    1. **생성과 소멸은 허용** → 객체 생성 가능
    2. **복사 생성자/대입 연산자는 private, 정의 없음** → 외부/링크에서 차단
    3. 파생 클래스에서 `public`으로 상속할 필요 없음 → private 상속 가능
- `HomeForSale`에 적용:

```cpp
class HomeForSale : private Uncopyable {
public:
    HomeForSale() {}
    // 더 이상 복사 생성자나 대입 연산자가 존재하지 않음
};

```

- 이제 `HomeForSale` 객체를 복사하려고 하면 컴파일러가 자동 생성 시도 → 실패
- 외부에서도 호출 불가 → 안전하게 복사 방지

---

## 4. 요약: 복사 방지 전략

| 방법 | 장점 | 주의점 |
| --- | --- | --- |
| 복사 생성자/대입 연산자 **private 선언, 정의 없음** | 간단, 클래스 자체에 적용 | 내부 멤버 함수나 friend에서 호출하면 링크 에러 |
| **Uncopyable** 상속 | 여러 클래스에 일괄 적용 가능 | 다중 상속 시 공백 클래스 최적화 주의, 소멸자 가상 여부 고려 |
- 실제 C++ 표준 라이브러리에서도 비슷한 방식 사용 (`noncopyable`, `ios_base` 등)
- 링크 시점 대신 **컴파일 시점에 복사 차단**하는 것도 가능 (기본 클래스 활용)

---

### 5. 핵심 개념

1. **자동 생성 복사 함수** → 모든 클래스에 기본 제공됨
2. **유일성을 보장하려면**:
    - 복사 생성자/대입 연산자를 **private 선언**
    - 정의는 제공하지 않음 → 호출 시 컴파일/링크 에러
3. **재사용 전략** → `Uncopyable` 상속으로 여러 클래스에 적용 가능

   *^^*
